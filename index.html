<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>Browser Info</title>
    <style>
        html {
            background-color: #333;
            color: #eee;
        }
        body {
            font-family: sans-serif;
            font-size: 11pt;
        }
        fieldset {
            border: 1px solid #666;
        }
        fieldset legend {
            color: #eee;
        }
        fieldset + fieldset {
            margin-top: 0.5em;
        }
        table {
            border-collapse: collapse;
            font-size: 90%;
            line-height: 110%;
            width: 100%;
        }
        table tr th {
            border: 1px dashed #666;
            font-weight: normal;
            padding: 1px 4px;
            text-align: left;
            white-space: nowrap;
            width: 15em;
        }
        table tr td {
            border: 1px dashed #666;
            padding: 1px 4px;
            white-space: pre-line;
        }
        fieldset q {
            color: #666;
        }
        fieldset q.ok {
            color: #eee;
        }
        fieldset q.good {
            color: #eee;
            text-decoration: underline;
        }
        fieldset q::before,
        fieldset q::after {
            content: "";
        }
        fieldset q + q {
            margin-left: 0.5em;
        }
        fieldset q sup {
            display: inline-block;
            font-size: 80%;
            line-height: 90%;
            margin-left: 0.2em;
            margin-right: -0.4em;
            width: 1.8em;
        }
        @media (hover: none)     { fieldset[name="style"] .hover .none     { color: #eee; } }
        @media (hover: hover)    { fieldset[name="style"] .hover .hover    { color: #eee; } }
        @media (pointer: none)   { fieldset[name="style"] .pointer .none   { color: #eee; } }
        @media (pointer: coarse) { fieldset[name="style"] .pointer .coarse { color: #eee; } }
        @media (pointer: fine)   { fieldset[name="style"] .pointer .fine   { color: #eee; } }
        @media (any-hover: none)     { fieldset[name="style"] .any-hover .none     { color: #eee; } }
        @media (any-hover: hover)    { fieldset[name="style"] .any-hover .hover    { color: #eee; } }
        @media (any-pointer: none)   { fieldset[name="style"] .any-pointer .none   { color: #eee; } }
        @media (any-pointer: coarse) { fieldset[name="style"] .any-pointer .coarse { color: #eee; } }
        @media (any-pointer: fine)   { fieldset[name="style"] .any-pointer .fine   { color: #eee; } }
        @media not all and (any-hover: none)     { fieldset[name="style"] .not-any-hover .none     { color: #eee; } }
        @media not all and (any-hover: hover)    { fieldset[name="style"] .not-any-hover .hover    { color: #eee; } }
        @media not all and (any-pointer: none)   { fieldset[name="style"] .not-any-pointer .none   { color: #eee; } }
        @media not all and (any-pointer: coarse) { fieldset[name="style"] .not-any-pointer .coarse { color: #eee; } }
        @media not all and (any-pointer: fine)   { fieldset[name="style"] .not-any-pointer .fine   { color: #eee; } }
        @media (color)      { fieldset[name="style"] .color .color      { color: #eee; } }
        @media (monochrome) { fieldset[name="style"] .color .monochrome { color: #eee; } }
        @media (color-gamut: srgb)    { fieldset[name="style"] .color-gamut .srgb    { color: #eee; } }
        @media (color-gamut: p3)      { fieldset[name="style"] .color-gamut .p3      { color: #eee; } }
        @media (color-gamut: rec2020) { fieldset[name="style"] .color-gamut .rec2020 { color: #eee; } }
        @media (display-mode: fullscreen) { fieldset[name="style"] .display-mode .fullscreen { color: #eee; } }
        @media (display-mode: standalone) { fieldset[name="style"] .display-mode .standalone { color: #eee; } }
        @media (display-mode: minimal-ui) { fieldset[name="style"] .display-mode .minimal-ui { color: #eee; } }
        @media (display-mode: browser)    { fieldset[name="style"] .display-mode .browser    { color: #eee; } }
        @media (orientation: portrait)  { fieldset[name="style"] .orientation .portrait  { color: #eee; } }
        @media (orientation: landscape) { fieldset[name="style"] .orientation .landscape { color: #eee; } }
        @media (prefers-color-scheme: light) { fieldset[name="style"] .prefers-color-scheme .light { color: #eee; } }
        @media (prefers-color-scheme: dark)  { fieldset[name="style"] .prefers-color-scheme .dark  { color: #eee; } }
        @media (prefers-contrast: no-preference) { fieldset[name="style"] .prefers-contrast .no-preference { color: #eee; } }
        @media (prefers-contrast: more)          { fieldset[name="style"] .prefers-contrast .more          { color: #eee; } }
        @media (prefers-contrast: less)          { fieldset[name="style"] .prefers-contrast .less          { color: #eee; } }
        @media (prefers-contrast: custom)        { fieldset[name="style"] .prefers-contrast .custom        { color: #eee; } }
        @media (prefers-reduced-motion: no-preference) { fieldset[name="style"] .prefers-reduced-motion .no-preference { color: #eee; } }
        @media (prefers-reduced-motion: reduce)        { fieldset[name="style"] .prefers-reduced-motion .reduce        { color: #eee; } }
        @supports (-webkit-touch-callout: none) { fieldset[name="style"] .webkit-touch-callout .none { color: #eee; } }
    </style>
</head>
<body>
    <fieldset name="agent">
        <legend>User-Agent</legend>
        <table></table>
    </fieldset>
    <fieldset name="media">
        <legend>Media Capabilities</legend>
        <table></table>
    </fieldset>
    <fieldset name="style">
        <legend>Media Queries</legend>
        <table>
            <tr class="hover"><th>hover</th><td><q class="none">none</q><q class="hover">hover</q></td></tr>
            <tr class="pointer"><th>pointer</th><td><q class="none">none</q><q class="coarse">coarse</q><q class="fine">fine</q></td></tr>
            <tr class="any-hover"><th>any-hover</th><td><q class="none">none</q><q class="hover">hover</q></td></tr>
            <tr class="any-pointer"><th>any-pointer</th><td><q class="none">none</q><q class="coarse">coarse</q><q class="fine">fine</q></td></tr>
            <tr class="not-any-hover"><th>not all and any-hover</th><td><q class="none">none</q><q class="hover">hover</q></td></tr>
            <tr class="not-any-pointer"><th>not all and any-pointer</th><td><q class="none">none</q><q class="coarse">coarse</q><q class="fine">fine</q></td></tr>
            <tr class="color"><th>color</th><td><q class="color">color</q><q class="monochrome">monochrome</q></td></tr>
            <tr class="color-gamut"><th>color-gamut</th><td><q class="srgb">srgb</q><q class="p3">p3</q><q class="rec2020">rec2020</q></td></tr>
            <tr class="display-mode"><th>display-mode</th><td><q class="fullscreen">fullscreen</q><q class="standalone">standalone</q><q class="minimal-ui">minimal-ui</q><q class="browser">browser</q></td></tr>
            <tr class="orientation"><th>orientation</th><td><q class="portrait">portrait</q><q class="landscape">landscape</q></td></tr>
            <tr class="prefers-color-scheme"><th>prefers-color-scheme</th><td><q class="light">light</q><q class="dark">dark</q></td></tr>
            <tr class="prefers-contrast"><th>prefers-contrast</th><td><q class="no-preference">no-preference</q><q class="more">more</q><q class="less">less</q><q class="custom">custom</q></td></tr>
            <tr class="prefers-reduced-motion"><th>prefers-reduced-motion</th><td><q class="no-preference">no-preference</q><q class="reduce">reduce</q></td></tr>
            <tr class="webkit-touch-callout"><th>-webkit-touch-callout</th><td><q class="none">none</q></td></tr>
        </table>
    </fieldset>
    <fieldset name="misc">
        <legend>Miscellaneous</legend>
        <table>
            <tr><th>"ontouchend" in document</th><td id="ontouchend in document"></td></tr>
            <tr><th>navigator.maxTouchPoints</th><td id="navigator.maxTouchPoints"></td></tr>
            <tr><th>screen.width,height</th><td id="screen.width,height"></td></tr>
            <tr><th>window.devicePixelRatio</th><td id="window.devicePixelRatio"></td></tr>
            <tr><th>window.innerWidth,Height</th><td id="window.innerWidth,Height"></td></tr>
        </table>
    </fieldset>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            //#region User-Agent
            /** @type {HTMLTableElement} */
            const table = document.querySelector('[name="agent"] table');
            const add = function (name, value) {
                const tr = table.insertRow();
                tr.appendChild(document.createElement('th')).textContent = name;
                tr.insertCell().textContent = JSON.stringify(value);
            };
            if (navigator.connection) {
                add('navigator.connection.downlink', navigator.connection.downlink);
                add('navigator.connection.rtt'     , navigator.connection.rtt     );
                add('navigator.connection.saveData', navigator.connection.saveData);
            }
            add('navigator.platform' , navigator.platform );
            add('navigator.userAgent', navigator.userAgent);
            if (navigator.userAgentData) {
                const lowEntropyHints  = ['brands', 'mobile', 'platform'];
                const highEntropyHints = ['architecture', 'bitness', 'formFactors', 'fullVersionList', 'model', 'platform', 'platformVersion', 'uaFullVersion', 'wow64'];
                const lowEntropyValues = lowEntropyHints.reduce(function (values, hint) {
                    if (hint in navigator.userAgentData)
                        values[hint] = navigator.userAgentData[hint];
                    return values;
                }, {});
                Object.keys(lowEntropyValues).forEach(function (name) {
                    add('navigator.userAgentData.' + name, lowEntropyValues[name]);
                });
                if (navigator.userAgentData.getHighEntropyValues) {
                    navigator.userAgentData.getHighEntropyValues(highEntropyHints).then(function (values) {
                        Object.keys(values).forEach(function (name) {
                            if (name in lowEntropyValues)
                                return;
                            add('navigator.userAgentData.' + name, values[name]);
                        });
                        add('navigator.vendor', navigator.vendor);
                    });
                } else {
                    add('navigator.vendor', navigator.vendor);
                }
            }
            //#endregion

            //#region Media Capabilities
            if (navigator.requestMediaKeySystemAccess || window.MSMediaKeys) {
                /**
                 * @type {Record<string,
                 *   { type: "audio", formats: ("mp4" | "webm")[], profiles: Record<string, { bitrate: number, channels: number | string, samplerate: number, params: string }> } |
                 *   { type: "video", formats: ("mp4" | "webm")[], profiles: Record<string, { bitrate: number, width: number, height: number, framerate: number, params: string }> }
                 * >}
                 */
                const codecs = {
                    'AC-3': { type: 'audio', formats: ['mp4'], profiles: {
                        ''                  : { bitrate:   320000, channels: '5.1', samplerate: 48000, params: 'ac-3' },
                    } },
                    'AAC' : { type: 'audio', formats: ['mp4'], profiles: {
                        'AAC-LC'            : { bitrate:   320000, channels:     2, samplerate: 48000, params: 'mp4a.40.2'  },
                        'HE-AAC'            : { bitrate:    64000, channels:     2, samplerate: 48000, params: 'mp4a.40.5'  },
                        'HE-AAC v2'         : { bitrate:    32000, channels:     2, samplerate: 48000, params: 'mp4a.40.29' },
                    } },
                    'Opus': { type: 'audio', formats: ['mp4', 'webm'], profiles: {
                        ''                  : { bitrate:   320000, channels:     2, samplerate: 48000, params: 'opus' },
                    } },
                    'AV1' : { type: 'video', formats: ['mp4', 'webm'], profiles: {
                        'Main @ 4.0'        : { bitrate:  1000000, width: 1920, height: 1080, framerate: 30, params: 'av01.0.08M.08' },
                        'Main @ 5.1'        : { bitrate:  8000000, width: 3840, height: 2160, framerate: 60, params: 'av01.0.13M.08' },
                        'Main @ 4.0 HDR'    : { bitrate:  1000000, width: 1920, height: 1080, framerate: 30, params: 'av01.0.08M.10' },
                        'Main @ 5.1 HDR'    : { bitrate:  8000000, width: 3840, height: 2160, framerate: 60, params: 'av01.0.13M.10' },
                    } },
                    'AVC' : { type: 'video', formats: ['mp4'], profiles: {
                        'Main @ 4.0'        : { bitrate:  2000000, width: 1920, height: 1080, framerate: 30, params: 'avc1.4d4028' },
                        'High @ 5.1'        : { bitrate: 12000000, width: 3840, height: 2160, framerate: 30, params: 'avc1.640033' },
                        'High @ 5.2'        : { bitrate: 16000000, width: 3840, height: 2160, framerate: 30, params: 'avc1.640033' },
                    } },
                    'HEVC': { type: 'video', formats: ['mp4'], profiles: {
                        'Main @ 5.1'        : { bitrate:  8000000, width: 3840, height: 2160, framerate: 60, params: 'hvc1.1.6.L153.90' },
                        'Main 10 @ 5.1 HDR' : { bitrate:  8000000, width: 3840, height: 2160, framerate: 60, params: 'hvc1.2.4.L153.B0' },
                    } },
                    'VP9' : { type: 'video', formats: ['mp4', 'webm'], profiles: {
                        'Profile 0, 5.0'    : { bitrate:  8000000, width: 3840, height: 2160, framerate: 60, params: 'vp09.00.50.08'             },
                        'Profile 2, 5.0 HDR': { bitrate:  8000000, width: 3840, height: 2160, framerate: 60, params: 'vp09.02.50.10.01.09.16.09' },
                    } },
                };
                const keySystems = ['com.apple.fps', 'com.microsoft.playready', 'com.widevine.alpha', 'org.w3.clearkey'];
                const capabilities = ['supported', 'smooth', 'powerEfficient'];
                /** @type {HTMLTableElement} */
                const table = document.querySelector('[name="media"] table');
                const noop = function () {};
                Object.keys(codecs).forEach(function (name) {
                    const codec = codecs[name];
                    codec.formats.forEach(function (format) {
                        Object.keys(codec.profiles).forEach(function (desc) {
                            const profile = codec.profiles[desc];
                            const contentType = codec.type + '/' + format + '; codecs="' + profile.params + '"';
                            const tr = table.insertRow();
                            const th = tr.appendChild(document.createElement('th'));
                            const td = tr.insertCell();
                            th.textContent = contentType, th.title = desc ? desc.indexOf(name) < 0 ? name + ' ' + desc : desc : name;
                            if (navigator.mediaCapabilities) {
                                const quotes = capabilities.reduce(function (map, cap) {
                                    map[cap] = td.appendChild(document.createElement('q'));
                                    map[cap].textContent = cap;
                                    return map;
                                }, {});
                                navigator.mediaCapabilities.decodingInfo(codec.type === 'audio' ? {
                                    type: 'media-source',
                                    audio: {
                                        contentType: contentType,
                                        bitrate: profile.bitrate,
                                        channels: profile.channels,
                                        samplerate: profile.samplerate,
                                    }
                                } : {
                                    type: 'media-source',
                                    video: {
                                        contentType: contentType,
                                        bitrate: profile.bitrate,
                                        width: profile.width,
                                        height: profile.height,
                                        framerate: profile.framerate,
                                    }
                                }).then(function (result) {
                                    capabilities.forEach(function (cap) {
                                        if (result[cap])
                                            quotes[cap].className = 'ok';
                                    });
                                }).catch(noop);
                            } else if (window.MSMediaKeys) {
                                const supported = td.appendChild(document.createElement('q'));
                                const acceleration = td.appendChild(document.createElement('q'));
                                supported.textContent = 'supported';
                                acceleration.textContent = 'decoder-hardware-acceleration';
                                if (MediaSource.isTypeSupported(contentType))
                                    supported.className = 'ok';
                                if (MSMediaKeys.isTypeSupportedWithFeatures('com.microsoft.playready', contentType + '; features="decoder-hardware-acceleration"'))
                                    acceleration.className = 'ok';
                            }
                            keySystems.forEach(function (keySystem) {
                                const initDataTypes = /fps/.test(keySystem) ? ['skd', 'sinf'] : format === 'webm' ? ['cenc', 'webm'] : ['cenc'];
                                const robustness = /widevine/.test(keySystem) ? 'SW_SECURE_CRYPTO' : '';
                                const q = td.appendChild(document.createElement('q'));
                                q.textContent = keySystem;
                                if (navigator.requestMediaKeySystemAccess) {
                                    const sup = MediaKeys.prototype.getStatusForPolicy && !/clearkey/.test(keySystem) ? q.appendChild(document.createElement('sup')) : undefined;
                                    sup && (sup.textContent = 'N/A');
                                    navigator.requestMediaKeySystemAccess(keySystem, [codec.type === 'audio' ? {
                                        initDataTypes: initDataTypes,
                                        audioCapabilities: [{ contentType: contentType, robustness: robustness }],
                                    } : {
                                        initDataTypes: initDataTypes,
                                        videoCapabilities: [{ contentType: contentType, robustness: robustness }],
                                    }]).then(function (access) {
                                        const config = access.getConfiguration();
                                        if (!config.audioCapabilities.length && !config.videoCapabilities.length)
                                            throw new DOMException('Unsupported keySystem or supportedConfigurations.');
                                        const types = config.initDataTypes.join(', ');
                                        q.className = 'ok', q.title = types;
                                        delete config.distinctiveIdentifier;
                                        delete config.persistentState;
                                        if (/playready/.test(keySystem)) {
                                            q.title = types + ' (SL2000)';
                                            (config.audioCapabilities[0] || config.videoCapabilities[0]).robustness = '3000';
                                            navigator.requestMediaKeySystemAccess(keySystem + '.recommendation', [config]).then(function (a) {
                                                const c = a.getConfiguration();
                                                if (c.audioCapabilities.length || c.videoCapabilities.length) {
                                                    q.className = 'good';
                                                    q.title = types + ' (SL3000)';
                                                }
                                            }).catch(noop);
                                        }
                                        if (/widevine/.test(keySystem)) {
                                            q.title = types + ' (L3)';
                                            config.audioCapabilities.length && (config.audioCapabilities[0].robustness = 'HW_SECURE_CRYPTO');
                                            config.videoCapabilities.length && (config.videoCapabilities[0].robustness = 'HW_SECURE_ALL');
                                            navigator.requestMediaKeySystemAccess(keySystem, [config]).then(function (a) {
                                                const c = a.getConfiguration();
                                                if (c.audioCapabilities.length || c.videoCapabilities.length) {
                                                    q.className = 'good';
                                                    q.title = types + ' (' + (c.videoCapabilities.length ? 'L1' : 'L2') + ')';
                                                }
                                            }).catch(noop);
                                        }
                                        return access.createMediaKeys();
                                    }).then(function (keys) {
                                        if (sup && keys.getStatusForPolicy) {
                                            Promise.all(['2.3', '2.2', '1.4', '1.0'].map(function (v) {
                                                return keys.getStatusForPolicy({ minHdcpVersion: v }).then(function (status) {
                                                    return status === 'usable' ? v : undefined;
                                                }).catch(noop);
                                            })).then(function (versions) {
                                                const v = versions.filter(function (v) { return !!v; })[0];
                                                if (v) {
                                                    sup.textContent = v;
                                                    sup.title = 'HDCP ' + v;
                                                }
                                            });
                                        }
                                    }).catch(noop);
                                } else if (window.MSMediaKeys) {
                                    if (MSMediaKeys.isTypeSupported(keySystem, contentType))
                                        q.className = 'ok';
                                }
                            });
                        });
                    });
                });
            }
            //#endregion

            //#region Miscellaneous
            document.getElementById('ontouchend in document').textContent   = 'ontouchend' in document;
            document.getElementById('navigator.maxTouchPoints').textContent = navigator.maxTouchPoints;
            document.getElementById('screen.width,height').textContent      = screen.width + 'x' + screen.height;
            document.getElementById('window.devicePixelRatio').textContent  = window.devicePixelRatio;
            document.getElementById('window.innerWidth,Height').textContent = window.innerWidth + 'x' + window.innerHeight;
            window.addEventListener('resize', function () {
                document.getElementById('screen.width,height').textContent      = screen.width + 'x' + screen.height;
                document.getElementById('window.devicePixelRatio').textContent  = window.devicePixelRatio;
                document.getElementById('window.innerWidth,Height').textContent = window.innerWidth + 'x' + window.innerHeight;
            });
            //#endregion
        });
    </script>
</body>
</html>
